---
title: "p8105_hw5_kp3127"
output: html_document
date: "2025-11-05"
---
```{r setup, echo=FALSE}
library(tidyverse)
library(rvest)
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
set.seed(1)
```

# Problem 1
Write a function to check whether there are duplicate birthdays in the group
```{r}
bd_check <- function(n, days = 365) {
  bdays <- sample.int(days, size = n, replace = TRUE)
  any(duplicated(bdays))
}
```

Compute the probability for each group size between 2 and 50, running 10000 times:
```{r}
sim_df=
  tibble(gp_size=2:50) %>% 
  mutate(prob=map_dbl(.x=gp_size,~mean(replicate(10000,bd_check(.x)))))
```

```{r}
sim_df |>
  ggplot(aes(x = gp_size, y = prob)) +
  geom_line() +
  geom_point() +
  geom_hline(yintercept = 0.5, linetype = 2) +
  labs(
    title = "Birthday problem: Pr(≥2 share a birthday) vs group size",
    x = "Group size (n)",
    y = "Estimated probability (10,000 sims per n)"
  ) +
  theme_minimal()
```
The curve rises monotonically with group size. It crosses 0.50 when n = 23.  
This result matches the classic birthday paradox: with just 23 people, there’s over a 50% chance at least two share a birthday.

# Problem 2
```{r}
library(broom)
```

For a given mu, create a function to get the results of mu_hat and p-value
```{r}
set.seed(1)
n      <- 30
sigma  <- 5
mus    <- 0:6
n_sim  <- 5000
alpha  <- 0.05

sim_ttest = function(mu) {
  map_dfr(1:n_sim, function(i) {
    x = rnorm(n, mean = mu, sd = sigma)
    ttest = tidy(t.test(x, mu = 0))
    tibble(
      mu = mu,
      mu_hat = ttest$estimate,   
      p = ttest$p.value,    
      reject = p < alpha
    )
  })
}
```

Repeat the function for different mu[0:6] 
```{r}
sim_res=map_dfr(mus, sim_ttest)
```

Calculate the power
```{r}
power_df=sim_res %>% 
  group_by(mu) %>% 
  summarize(power=mean(reject))
```

Describe the association between effect size and power.
```{r}
power_df |>
  ggplot(aes(mu, power)) +
  geom_point() + geom_line() +
  scale_x_continuous(breaks = mus, limits = c(0, 6)) +
  labs(title = "Power of one-sample t-test (n = 30, σ = 5, α = 0.05)",
       x = "True mean (μ)", y = "Estimated power (5,000 sims)") +
  theme_minimal()
```

